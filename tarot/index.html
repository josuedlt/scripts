<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
</head>

<body>
    <div id="app" v-cloak>
        <div class="ui sidebar inverted vertical menu">

            <div class="item">
                <div class="ui fluid form">
                    <div class="field" v-if="deckImages">
                        <p>Deck Images</p>
                        <select class="ui fluid input item" v-model="deckImagesIndex">
                            <option v-for="(deck, i) in deckImages" :value="i">{{ deck.title }}</option>
                        </select>
                        <div class="ui fluid input">
                            <input type="range" min="0" :max="deckImages.length - 1" v-model="deckImagesIndex">
                        </div>
                        <p>Image Size</p>
                        <div class="ui fluid input">
                            <input type="range" min="50" :max="300" v-model="imageSize">
                        </div>
                    </div>
                </div>
            </div>

            <div class="item">
                <div class="ui fluid form">
                    <div class="field">
                        <select class="ui fluid input item" v-model="drawCount" @change="drawCard">
                            <option value="0">All Cards</option>
                            <option v-for="i in [1,3,5,7]" :value="i">Draw {{ i }}</option>
                        </select>
                    </div>
                    <div class="ui basic inverted button" v-if="drawCount > 0" @click="drawCard">New Draw</div>
                    <div class="ui basic inverted button" v-if="drawCount > 0" @click="drawCount = 0; drawCard();">All
                        Cards</div>
                </div>
            </div>

            <div class="item">
                <div class="ui button" @click="resetSettings">Reset Settings</div>
            </div>
        </div>
        <div class="pusher" v-if="deckImages">
            <div class="ui fixed inverted menu">
                <div class="item" onclick="$('.ui.sidebar').sidebar('show')"><i class="ui sliders horizontal icon"></i>
                </div>
                <div class="item" v-html="deckImages[deckImagesIndex].title"></div>
            </div>

            <div class="ui basic segment">
                <div class="ui link cards">
                    <div class="ui centered basic card" v-for="(card, i) in reading ?? deck" :key="i"
                        @click="showModal(card)" :style="{'max-width': imageSize}"
                        onclick="$('.ui.modal').modal('show');">
                        <div class="image" :class='{ reversed: card.reversed }'>
                            <img v-bind:src="card.imgSrc">
                        </div>
                    </div>
                </div>


                <div class="ui basic modal" v-if="card">
                    <div class="content">
                        <div class="ui center aligned grid">
                            <div class="text-capitalize center aligned segment">
                                <span style="font-size: 2em">{{ card.name }}</span>
                            </div>
                        </div>
                        <div class="ui one column center aligned grid">
                            <div class="column">
                                <div class="ui two column grid">
                                    <img class="column" :src="'decks/' + deckImages[92].path + '/' + card.idx + '.jpg'">
                                    <img class="column" :src="'decks/' + deckImages[deckImagesIndex].path + '/' + card.idx + '.jpg'">
                                </div>
                            </div>
                            <div class="column">
                                <p v-html="card.desc"></p>
                            </div>
                            <div class="column">
                                <h4>Light</h4>
                                <p v-html="card.meaning_up"></p>
                            
                                <h4>Shadow</h4>
                                <p v-html="card.meaning_rev"></p>
                            </div>
                        </div>
                        <!-- <div class="ui dividing large header">
                        </div>
                        <div class="ui equal width center aligned stackable grid">
                            <div class="column" v-for="keyword in card.keywords" :key="keyword">
                                <strong class="ui round label" v-html="keyword"></strong>
                            </div>
                        </div>
                        <div class="ui equal width center aligned grid" style="font-size: 1.5em !important;">
                            <div class="column ui list">
                                <div class="item" v-for="tell in card.fortune_telling" :key="tell">{{tell}}</div>
                            </div>
                        </div>
                        <div class="ui equal width stackable center aligned grid">
                            <div class="column" v-if="!card.reversed ?? true">
                                <h3 v-if="card.reversed ?? true">Light</h3>
                                <div class="ui list">
                                    <div class="item" v-for="item in card.meanings.light" :key="item">{{item}}</div>
                                </div>
                            </div>
                            <div class="column" v-if="card.reversed ?? true">
                                <h3 v-if="!card.reversed ?? true">Shadow</h3>
                                <div class="ui list">
                                    <div class="item" v-for="item in card.meanings.shadow" :key="item">{{item}}</div>
                                </div>
                            </div>
                        </div> -->
                        <div class="ui center aligned grid">
                            <div class="ui button" onclick="$('.modal').modal('hide')">Close</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<style>
    .inverted select {
        border: none
    }

    .pusher {
        padding-top: 1em;
        background-color: #333 !important;
        min-height: 100%;
    }

    .reversed {
        transform: rotate(180deg)
    }

    .text-capitalize {
        text-transform: capitalize
    }

    [v-cloak] {
        display: none
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>

<script src="https://unpkg.com/axios/dist/axios.js"></script>
<script src="https://unpkg.com/lodash"></script>
<script src="https://unpkg.com/vue"></script>
<script>
    var app = new Vue({
        el: '#app',
        data: {

            deck: [],
            deckImages: null,
            deckImagesIndex: null,
            drawCount: 0,
            imageSize: null,

            reading: null,
            card: null,
        },
        watch: {
            deckImagesIndex(newValue, oldValue) {
                localStorage.setItem('deckImagesIndex', newValue)
                this.deck.forEach((card, i) => card.imgSrc = `decks/${this.deckImages[newValue].path}/${card.idx}.jpg`)
            },
            drawCount(newValue, oldValue) {
                localStorage.setItem('drawCount', newValue)
                this.drawCard()
            },
            imageSize(newValue, oldValue) {
                localStorage.setItem('imageSize', newValue);
                this.imageSize = newValue;
            }
        },
        methods: {
            showModal(card) {
                this.card = card;
                this.$forceUpdate();
            },
            drawCard() {
                if (this.drawCount == 0)
                    this.reading = null
                else
                    this.reading = _(this.deck).shuffle().take(this.drawCount).map(o => {
                        o.reversed = (Math.random() < 0.5);
                        return o;
                    }).value()
            },
            loadSettings() {
                this.deckImagesIndex = localStorage.getItem('deckImagesIndex') ?? 92;
                this.drawCount = localStorage.getItem('drawCount') ?? 0;
                this.imageSize = localStorage.getItem('imageSize') ?? 150;
            },
            resetSettings() {
                localStorage.clear();
                this.loadSettings();
            }
        },
        created() {
            //axios.get('cards/tarot_interpretations.json').then(({ data }) => {
            axios.get('cards/card_data_v2.json').then(({ data }) => {
                this.deck = data.cards
                this.deck.forEach((card, idx) => card.idx = idx)

                // this.deck = _(this.deck)
                //     .filter(card => {
                //         if (isNaN(card.rank)) return false;
                //         return card.rank > 0 && card.rank <= 10
                //     })
                //     .orderBy('rank')
                //     .value();

                axios.get('decks/decks.json').then(({ data }) => {
                    this.deckImages = data
                    this.loadSettings();
                })
            })
        }
    })

    $('.ui.sidebar').sidebar('setting', 'transition', 'overlay');
</script>

</html>